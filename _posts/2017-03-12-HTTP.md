---
layout: post
title: "HTTP"
date: 2017-03-12
---

# HTTP

### 浏览器连接处理
* 浏览器从 URL 中解析出服务器的主机名
* 浏览器将服务器的主机名转换成服务器的 IP 地址
* 浏览器将端口号(如果有的话)从 URL 中解析出来
* 浏览器建立一条与 Web 服务器的 TCP 连接
* 浏览器向服务器发送一条 HTTP 请求报文
* 服务器向浏览器回送一条 HTTP 相应报文
* 关闭连接，浏览器显示文档

### URI
URI(统一资源标识符)是一种更通用的资源表示符，由子集 URL (统一资源定位符)和 URN (统一资源名)构成。

URL：(网络资源的标准化名称)目的是为应用程序提供了一种访问资源的手段，简化信息的访问过程。

URL的语法：

		<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
  		 方案       用户     密码      主机    端口    路径    参数      查询    片段

  
最重要的部分：方案(scheme)、主机(host)和路径(path)

各种协议使用的URL格式

		http://<host>:<port>/<path>?<query>#<frag>   //默认端口80
		https://<host>:<port>/<path>?<query>#<frag>  //默认端口443  使用网景SSL
		ftp://<user>:<password>@<host>:<port>/<path>;<params>  //文件传输+目录结构
		rtsp://<user>:<password>@<host>:<port>/<path>  //实时流传输协议：视频|音频

### HTTP 报文

##### HTTP 报文的组成部分
报文由三部分组成：

* 起始行：对报文进行描述
* 首部：包含属性
* 主体：可选的、包含数据

起始行和首部是由行分割的 ASCII 文本，每行都是以一个由两个字符(回车符：13，换行符：10)组成的行终止序列作为结束。主体是一个可选的数据块，可以包含文本和二进制数据，也可以为空。

请求报文和响应报文格式：
![](http://i.imgur.com/kGXLnD6.png)

##### 请求报文支持的方法
GET、HEAD、PUT、POST、TRACE、OPTIONS、DELETE

##### 响应报文返回的状态码
100~199：信息性状态码  
200~299：成功状态码  
300~399：重定向状态码  
400~499：客户端错误状态码  
500~599：服务器错误状态码

##### 首部
通用首部  
请求首部  
响应首部  
实体首部  
扩展首部  


### HTTP 连接管理
##### HTTP 如何使用 TCP 连接

##### TCP 连接的时延、瓶颈以及存在的障碍
* TCP 连接建立握手
* TCP 慢启动拥塞控制
* 数据聚焦的 Nagle 算法
	* 在发送一个分组之前，将大量TCP数据绑定在一起，以提高网络效率。设置参数 TCP_NODELAY，禁用 Nagle 算法
* 用于捎带确认的 TCP 延迟确认算法
* TIME_WAIT 时延和端口耗尽

##### HTTP 的优化，并行连接、持久连接、管道化连接
**并行连接:** 通过多条 TCP 连接发起并发的 HTTP 请求  
打开大量连接会消耗很多内存资源，从而引发自身的性能问题。浏览器会将并行连接的总数限制为一个较小的值。  

并行连接的缺点：

* 每个事物都打开/关闭一条新的连接，会耗费时间和带宽
* 由于 TCP 慢启动特性的存在，每条新连接的性能都会有所下降
* 可以打开的并行连接数量实际上是有限的
 

**持久连接：** 重用 TCP 连接，以消除连接及关闭时延  
在事物处理结束之后仍然保持在打开状态的 TCP 连接成为持久连接。
管理持久化连接时要特别小心，不然会累积出大量的空闲连接，耗费本地以及远程客户端和服务器上的资源。  

持久连接的类型：

* HTTP/1.0+ "keep-alive"
* HTTP/1.1  "persistent"

**keep-alive:**

默认是关闭的
去除了进行连接和关闭连接的开销，和慢启动带来的影响  
客户端请求首部包含 Connection：Keep-Alive
服务器愿意保持连接,响应报文首部包含 Connection：Keep-Alive  

盲中继：不理解 Connection 首部，而且不是道在沿着转发链路将其发送出去之前，应该将该首部删除的代理。他们只是将字节从一个连接转发到另一个连接中去。

盲中继造成客户端和服务器都认为他们在进行 keep-alive 对话，而代理对此一无所知。忽略客户端的请求，等待源端服务器关闭连接。

**persistent connection**
默认情况下是激活的，假定所有连接都是持久的。  
一个客户端对任何服务器或代理最多只能维持两条持久连接，防止服务器过载。

**管道化连接：** 通过共享的 TCP 连接发起并发的 HTTP 请求  
**复用连接：** 交替传递请求和响应报文
### 参考文献

HTTP 权威指南

[HTTP幂等性](http://www.cnblogs.com/weidagang2046/archive/2011/06/04/idempotence.html)


