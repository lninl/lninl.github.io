---
layout: post
title: "线程"
date: 2017-03-12
---

# 线程
---
### 竞争

++ 操作被编译为汇编代码之后不止一条指令

### 线程分类
用户级线程：有关线程管理的所有工作都由应用程序完成，内核意识不到线程的存在  
优点：

* 线程切换不需要内核态特权
* 调度可以使应用程序相关，自定义调度策略，简单轮转，优先级调度...
* 可以在任何操作系统中运行，不需要底层内核进行修改以支持用户级线程

缺点：

* 一个线程阻塞，进程中的所有线程都会被阻塞
* 一个多线程应用程序无法利用多处理器

内核级线程：有关线程管理的所有工作都是在内核中完成

相对缺点：

* 线程切换需要到内核态切换



### 可重入与线程安全：  

可重入：函数没有执行完成，由于外部因素或内部调用，又一次进入该函数执行。

* 多个线程同时执行这个函数
* 函数自身(可能经过多层调用之后)调用自己

可重入的要求：

* 不使用任何(局部)静态或全局的非 const 变量
* 不返回任何(局部)静态或全局的非 const 变量的指针
* 仅依赖调用方提供的参数？
* 不依赖任何单个资源的锁？
* 不调用任何不可重入的函数

过度优化：

volatile 关键字:

* 阻止编译器为提高速度将一个变量缓存到寄存器而不写回
* 阻止编译器调整操作 volatile 变量的指令顺序
